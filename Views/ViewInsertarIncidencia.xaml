<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProjecteFinal.Views.ViewInsertarIncidencia"
             x:Name="ParentPage"
             Title="Insertar Incidencia">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <!-- Tipo de Incidencia -->
            <Label Text="Tipo de Incidencia" FontAttributes="Bold" TextColor="#2C3E50" />
            <Picker ItemsSource="{Binding Tipos}" 
                    SelectedItem="{Binding TipoSeleccionado}" 
                    Title="Seleccione un tipo de incidencia" />

            <!-- Campos generales -->
            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Descripción Detallada" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Editor Placeholder="Ejemplo: El ordenador no enciende" Text="{Binding Incidencia.descripcionDetallada}" HeightRequest="100" />

                    <Label Text="Aula" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: Aula 101" Text="{Binding Incidencia.aulaUbicacion}" />

                    <Label Text="Fecha de la Incidencia" FontAttributes="Bold" TextColor="#2C3E50" />
                    <DatePicker Date="{Binding Incidencia.fechaIncidencia}" />

                    <Label Text="Observaciones" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Editor Placeholder="Ejemplo: Revisar fuente de alimentación" Text="{Binding Incidencia.observaciones}" HeightRequest="100" />

                    <!-- Adjuntar archivos -->
                    <Label Text="Adjuntar Archivos" FontAttributes="Bold" TextColor="#2C3E50" />
                    <StackLayout Orientation="Horizontal" Spacing="10">
                        <Button Text="Capturar Foto" Clicked="OnHacerFotoClicked" />
                        <Button Text="Seleccionar Archivo" Clicked="OnSeleccionarArchivoClicked" />
                    </StackLayout>

                    <!-- Lista de adjuntos -->
                    <CollectionView ItemsSource="{Binding Adjuntos}" HeightRequest="200" Margin="0,10,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="5" ColumnSpacing="10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Nombre del archivo -->
                                    <Label Text="{Binding Nombre}" VerticalOptions="Center" Grid.Column="0" />

                                    <!-- Botón Eliminar -->
                                    <Button Text="Eliminar"
                                    BackgroundColor="#F44336"
                                    TextColor="White"
                                    Command="{Binding BindingContext.EliminarAdjuntoCommand, Source={x:Reference ParentPage}}"
                                    CommandParameter="{Binding .}"
                                    Grid.Column="1"
                                    WidthRequest="100"
                                    HeightRequest="40"
                                    HorizontalOptions="End"
                                    VerticalOptions="Center" /> 
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>



                </VerticalStackLayout>
            </Frame>

            <!-- Formulario específico para cada tipo -->
            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True" IsVisible="{Binding MostrarHW}">
                <VerticalStackLayout>
                    <Label Text="Dispositivo" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: Ordenador" Text="{Binding IncidenciaHW.dispositivo}" />

                    <Label Text="Modelo" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: HP Pavilion" Text="{Binding IncidenciaHW.modelo}" />

                    <Label Text="Número de Serie" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: 12345-67890" Text="{Binding IncidenciaHW.numeroSerie}" />
                </VerticalStackLayout>
            </Frame>

            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True" IsVisible="{Binding MostrarSW}">
                <VerticalStackLayout>
                    <Label Text="Sistema Operativo" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: Windows 10" Text="{Binding IncidenciaSW.sistemaOperativo}" />

                    <Label Text="Aplicación" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: Office 365" Text="{Binding IncidenciaSW.aplicacion}" />
                </VerticalStackLayout>
            </Frame>

            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True" IsVisible="{Binding MostrarRed}">
                <VerticalStackLayout>
                    <Label Text="Dispositivo Afectado" FontAttributes="Bold" TextColor="#2C3E50" />
                    <Entry Placeholder="Ejemplo: Router de la sala" Text="{Binding IncidenciaRed.dispositivoAfectado}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Botones -->
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="20">
                <Button Text="Guardar" Clicked="OnGuardarClicked" Style="{StaticResource PrimaryButtonStyle}" />
                <Button Text="Cancelar" Clicked="OnCancelarClicked" Style="{StaticResource DeleteButtonStyle}" />
            </StackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
