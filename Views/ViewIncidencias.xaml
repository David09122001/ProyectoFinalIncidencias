<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProjecteFinal.Views.ViewIncidencias"
             Title="Gestión de Incidencias"
             BackgroundColor="#F8F9FA">
    <StackLayout Padding="20" Spacing="15">
        <!-- Lista de incidencias -->
        <CollectionView ItemsSource="{Binding Incidencias}" SelectionMode="Single">
            <!-- Header -->
            <CollectionView.Header>
                <Grid ColumnSpacing="0" Padding="10, 0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <!-- Incidencia -->
                        <ColumnDefinition Width="1.2*" />
                        <!-- Estado -->
                        <ColumnDefinition Width="1.8*" />
                        <!-- Responsable -->
                        <ColumnDefinition Width="1.2*" />
                        <!-- Modificar -->
                        <ColumnDefinition Width="1.2*" />
                        <!-- Eliminar -->
                    </Grid.ColumnDefinitions>

                    <!-- Encabezados -->
                    <Label Text="Incidencia" FontAttributes="Bold" Grid.Column="0"
                           HorizontalTextAlignment="Start" VerticalTextAlignment="Center"
                           Padding="5, 0, 0, 0" />
                    <Label Text="Estado" FontAttributes="Bold" Grid.Column="1"
                           HorizontalTextAlignment="Start" VerticalTextAlignment="Center"
                           Padding="5, 0, 0, 0" />
                    <Label Text="Responsable" FontAttributes="Bold" Grid.Column="2"
                           HorizontalTextAlignment="Start" VerticalTextAlignment="Center"
                           Padding="5, 0, 0, 0" />

                </Grid>
            </CollectionView.Header>

            <!-- Template -->
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnSpacing="10" Padding="10, 5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <!-- Incidencia -->
                            <ColumnDefinition Width="1.2*" />
                            <!-- Estado -->
                            <ColumnDefinition Width="1.8*" />
                            <!-- Responsable -->
                            <ColumnDefinition Width="2.4*" />
                            <!-- Botones juntos -->
                        </Grid.ColumnDefinitions>
                        <Label Text="{Binding descripcionDetallada}" Grid.Column="0" 
                       HorizontalTextAlignment="Start" VerticalTextAlignment="Center" 
                       Padding="5, 0, 0, 0">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnIncidenciaTapped" CommandParameter="{Binding .}" />
                            </Label.GestureRecognizers>
                        </Label>

                        <!-- Estado -->
                        <Label Text="{Binding estado}" Grid.Column="1"
                   HorizontalTextAlignment="Start" VerticalTextAlignment="Center"
                   Padding="5, 0, 0, 0" >
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnIncidenciaTapped" CommandParameter="{Binding .}" />
                            </Label.GestureRecognizers>
                        </Label>

                        <!-- Responsable -->
                        <Label Text="{Binding responsableDni, TargetNullValue='Ningún profesor asignado'}" Grid.Column="2"
                   HorizontalTextAlignment="Start" VerticalTextAlignment="Center"
                   Padding="5, 0, 0, 0" >
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnIncidenciaTapped" CommandParameter="{Binding .}" />
                            </Label.GestureRecognizers>
                        </Label>

                        <!-- Botones Modificar y Eliminar -->
                        <StackLayout Orientation="Horizontal" Grid.Column="3" HorizontalOptions="EndAndExpand" Spacing="5">
                            <Button Text="Modificar" Clicked="OnEditClicked" CommandParameter="{Binding .}" 
                        Style="{StaticResource ModifyButtonStyle}" />
                            <Button Text="Eliminar" Clicked="OnDeleteClicked" CommandParameter="{Binding .}" 
                        Style="{StaticResource DeleteButtonStyle}" />
                        </StackLayout>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <!-- Botón para añadir incidencia -->
        <Button Text="Añadir Incidencia" Clicked="OnAddClicked" Style="{StaticResource PrimaryButtonStyle}" 
                HorizontalOptions="Center" VerticalOptions="End" />
    </StackLayout>
</ContentPage>
